## 라우팅(Routing)

네트워크에서 데이터(패킷)를 보낼 때 **최적의 경로**를 선택하는 과정이며 라우터가 이를 수행

데이터는 출발지에서 목적지로 가는 동안 여러개의 라우터를 거치며 여러번의 라우팅을 수행(보통 초당 수백만번)

<br>

## 라우터

라우터는 네트워크 사이에서 데이터를 전달하는 장치이며 보통 둘 이상의 서로 다른 네트워크에 연결

데이터(패킷)를 목적지로 보낼 때 최적의 경로를 결정하고 경로가 결정되면 해당 경로로 데이터를 넘겨주는 일(라우팅)을 수행

라우터는 라우팅테이블을 기반으로 데이터를 다음 목적지에게 전달

<br>

## 라우팅 테이블

네트워크를 연결하는 방법이 포함된 리스트

IP 주소를 기반으로 라우터의 위치를 저장한 테이블 또는 데이터베이스이며 다양한 네트워크에 대한 정보와 해당 네트워크에 연결하는 방법이 포함

### 라우팅 테이블의 구성 요소

- **네트워크 대상(Network Destination)** 목적지 네트워크의 IP 주소

- **서브넷 마스크(Netmask)** 대상 주소를 설명할 때 쓰이는 값

- **게이트웨이(Gateway)** 이 장치와 연결되어있는 홉, 패킷이 전달되는 다음 IP 주소(외부 네트워크와 연결된 장치)

  만약 목적지가 로컬 네트워크라면 연결됨(connected)이라고 표기 되며 다른 네트워크라면 해당 네트워크의 게이트웨이를 가리킴

- **인터페이스(Interface)** 게이트웨이로 가기 위해 거치는 장치 / 10.0.0.2는 eth3을 통해 접근이 가능

- **메트릭(Metric)** 우선순위라고도 불리며 패킷 전송을 위해 최적의 경로가 선택되도록 참고되는 값

  동일한 라우팅테이블 요소가 2개 있을 때 이 값이 낮은 요소가 선택되며 메트릭은 일반적으로 홉 수(hop count)가 들어가고 지연시간, 처리량 등이 들어갈 수 있음

### 게이트웨이(Gateway)

프로토콜 변환기라고도 하며 네트워크와 네트워크를 잇는 장치

라우터와 하는 기능이 비슷한 외부 네트워크가 있는 장치라고 보면 됨

### 홉(Hop)

네트워크에서 출발지와 목적지 사이에 위치한 장치를 의미하며 홉 카운트(Hop count)는 데이터가 출발지와 목적지 사이에서 통과해야 하는 홉의 개수를 의미

라우팅을 홉바이홉 통신이라고도 함

<br>

## IP 주소(Internet Protocol Address)

논리적 주소(변한다)이며 컴퓨터 네트워크에서 장치들이 서로를 인식하고 통신을 하기 위해서 사용하는 특수한 번호

IP를 기반으로 통신한다고도 하지만 사실상 그 밑의 물리적 주소인 MAC 주소를 통해 통신

<br>

## MAC 주소(Media Access Control Address)

네트워크 인터페이스에 할당된 고유 식별자이며 보통 장치의 NIC(LAN 카드에 설정)에 할당

48비트로 이루어져있으며 24비트의 OUI와 24비트의 UAA로 이루어짐

- OUI: IEEE에서 할당한 제조사 코드

- UAA: 제조사에서 구별되는 코드

- IEEE: 전기/전자/전산 분야의 국제 기구 및 학회

MAC주소는 보통은 유일하지만 유일하지 않을 수도 있음

실수 또는 의도적으로 UAA를 중복되게 만들 수도 있는데 이 때 동일 네트워크에서만 중복되지 않으면 문제 없음

또한 NIC에 고정된 MAC주소를 변경할 수는 있으나 하지 않는 것을 권장하며 하는 것 자체를 어렵게 한 OS도 있음

<br>

## ARP와 RARP

MAC주소는 ARP를 통해 파악이 가능하며 ARP를 통해 논리적 주소인 IP 주소를 물리적 주소인 MAC 주소로 변환

반대로 RARP를 통해 물리적 주소인 MAC 주소를 논리적 주소인 IP 주소로 변환

### ARP의 과정

1. 해당 IP주소에 맞는 MAC주소를 찾기 위해 해당 데이터를 **브로드캐스팅**을 통해 연결된 네트워크에 있는 장치한테 모두 보낸다

2. 맞는 장치가 있다면 해당 장치는 보낸 장치에게 유니캐스트로 데이터를 전달해 주소를 찾게 된다

<br>

## IPv4

32비트로 표현되는 주소체계이며 2^32개의 주소(41억 9천만 주소)를 표현할 수 있음

8비트(=옥텟) 단위로 점을 찍어 4개로 구분해서 표현하며 보통 8비트를 10진수로 표현

이 주소 체계만으로는 부족하기 때문에 NAT, 서브네팅 등 여러 개의 부수적인 기술이 생겨남

## IPv6

128비트로 표현되는 주소 체계이며 2^ 128개의 주소를 표현 즉, 많은 주소 처리 가능하며 NAT, 서브네팅이 필요하지 않음

16비트씩 8개로 구분하고 16비트는 16진수로 변환되어 콜론(:)으로 구분하여 표시하며 앞의 연속되는 0은 생략될 수 있음

### 차이점

**IPSec이 내장됨**

IPSec은 데이터 패킷을 암호화 하는 보안 네트워크 프로토콜 제품군을 말하며 이 제품군이 IPv6에 내장

**단순해진 헤더 포맷**

IPv6는 IPv4 헤더의 불필요한 필드를 제거하여 보다 빠른 처리 가능

**IPv4는 체크섬이 있지만 IPv6는 체크섬이 없다**

IPv4에는 CRC를 통한 손상된 패킷을 확인하고 폐기하는데 쓰는 체크섬 필드가 있지만(Header Checksum 필드) IPv6는 해당 체크섬 필드가 존재하지 않음

이유는 상위 프로토콜(TCP, UDP)에 체크섬 필드가 있기 때문에 헤더의 효율화를 위해 버전이 업그레이드되면서 사라졌기 때문

TCP, UDP 헤더 모두 체크섬 필드가 들어가 있는데 만약 체크섬 필드를 사용하지 않는 것으로 설정하고 싶다면 해당 필드의 값을 모두 0으로 만들면 되고 이를 통해 체크섬 필드를 유동적으로 사용하거나 사용하지 않게 만들 수 있음

하지만 IPv6 + UDP 로 사용할 경우 IPv6 의 헤더 내의 체크섬 필드가 없기 때문에 무조건 UDP 헤더의 체크섬 필드를 사용한다고 설정

IPv4는 헤더가 가변길이이지만 IPv6는 고정 길이(40바이트)라서 인터넷 헤더 길이에 대한 정보가 없고 이외에도 여러가지 불필요한 정보 삭제

**Q. IPv4와 IPv6 중 어떤게 좋나요?**

IPv6는 IPv4보다 많은 주소를 표현할 수 있고 IPv4보다 불필요한 헤더가 삭제되어서 빠르고 IPSec이라는 네트워크 보안 제품군이 포함되었기 때문에 보안적인 측면에서도 좋다

보통은 IPv6를 사용하는 것이 IPv4보다 속도가 더 빠르지만 일부 사용 사례에서는 속도가 느린 경우도 있다
