## 네트워크

노드와 링크가 서로 연결되어 있으며 리소스를 공유하는 집합

- 노드: 서버, 라우터, 스위치 등 네트워크 장치

- 링크(엣지): 유선 또는 무선과 같은 연결 매체(와이파이나 LAN)

ex) 핸드폰(노드)으로 와이파이(링크)에 연결해서 네이버 서버(노드)와 통신

<br>

## 트래픽

특정 시점에 링크 내에 흐르는 데이터의 양(단위: bps, bits per second)

ex) 서버에 저장된 파일(문서, 이미지, 동영상 등)을 클라이언트(사용자)가 다운로드 시 발생되는 데이터의 누적량

- 트래픽이 많아졌다 = 흐르는 데이터가 많아졌다
- 처리량이 많아졌다 = 처리되는 트래픽이 많아졌다

<br>

## 처리량(Throughput)

링크 내에서 성공적으로 전달된 데이터의 양을 말하며 보통 얼만큼의 트래픽을 처리했는지 나타냄(단위: bps)

사용자들이 많이 접속할 때마다 커지는 트래픽, 네트워크 장치 간의 대역폭, 네트워크 장치 간의 대역폭, 네트워크 중간에 발생하는 에러, 장치의 하드웨어 스펙에 영향을 받음

ex) 사용자들이 몰려서 트래픽이 높아지면 서버가 다운돼서 처리량은 낮아질 수 있음

- 많은 트래픽을 처리한다 = 많은 처리량을 가진다

<br>

## 대역폭(Bandwidth)

주어진 시간도안 네트워크 연결을 통해 흐를 수 있는 최대 비트 수를 말하며 최대로 처리할 수 있는 트래픽(단위: bps)

대역폭이 높을 수록 사용자에게 빠른 서비스를 제공

대략적인 최대 동시 접속자 수를 유추하는데의 척도가 됨

<br>

## RTT(Round Trip Time : 왕복 지연시간)

신호를 전송하고 해당 신호의 수신 확인에 걸린 시간을 더한 값

어떤 메시지가 두 장치 사이를 왕복하는 데 걸린 시간

<br>

## 네트워크 토폴로지

노드와 링크가 어떻게 구성되어있는지

### 버스 토폴로지

특징

- 하나의 회선에 여러 개의 노드
- 노드 추가, 삭제 쉬움
- 설치 비용 적음

장점

- 소규모 네트워크를 구축하기 매우 쉬움
- 한 노드에 장애가 발생해도 다른 노드에 영향 없음

단점

- 메인 링크에 많은 트래픽이 생기면 정체현상 발생 가능성 높음(패킷 손실율 높음)
- 메인 링크가 망가지면 큰 문제가 발생(하나의 회선에 의존하기 때문)

### 스타 토폴로지

특징

- 중앙에 있는 노드를 기반으로 연결된 형태
- 노드 추가, 삭제 쉬움

장점

- 중앙 노드가 아닌 한 노드에 장애가 발생해도 다른 노드에 영향 없음
- 안정성이 높음(중앙 노드가 아닌 한 노드에 침해가 발생했을 때 다른 노드로 확장하기가 어렵기 때문) → 다른 노드로 가려면 중앙노드를 무조건 거쳐야 하고 보통의 스타 토폴로지는 중앙 노드의 방화벽 등을 더욱 깐깐하게 해놓음
- 한 링크에 문제가 생겨도 해당 부분만 영향을 받고 나머지 부분은 정상적으로 작동

단점

- 중앙노드 에러 시 큰 문제 발생

### 트리 토폴로지

특징

- 트리 형태(계층적 토폴로지)
- 노드 추가, 삭제 보통(리프 노드를 기반으로 확장은 용이하지만 다른 노드는 어려움)
- 버스 토폴로지와 스타 토폴로지의 하이브리드 형태

장점

- 노드 확장이 용이(주로 리프 노드로 확장)
- 리프 노드의 에러는 나머지 부분에 영향을 미치지 않음

단점

- 특정 노드 트래픽 집중시 하위 노드에 영향
- 루트 노드에 문제가 생기면 전체 네트워크에 큰 문제 발생

ex) 백본 케이블: 여러 소형 네트워크들을 묶어 대규모 파이프라인을 통해 극도로 높은 대역폭으로 다른 네트워크들의 집합과 연결되는 네트워크

→ 보통 트리 토폴로지는 백본 케이블(대규모 패킷 통신망)을 기반으로 설계함

### 링형 토폴로지

특징

- 고리형태
- 노드 추가, 삭제가 쉬움(연결 리스트)

장점

- 노드 수가 많아져도 데이터 손실이 없음
→ 토큰을 기반으로 연속적으로 노드를 거치며 통신 권한 여부를 따지고 해당 권한이 없는 노드는 데이터를 전달받지 않음

단점

- 링크 또는 노드 하나만 에러가 발생해도 전체 네트워크에 영향
- 토큰이 없는 노드는 통신에 참여를 못하며 데이터 공유 불가능(일대일만 가능)

### 메시 토폴로지

특징

- 그물망 형태
- 노드 추가, 삭제 어려움(노드 삭제하면 연결된 회선들 다 삭제해야되기 때문)
- 풀(full)메시 토폴로지의 경우 n * (n - 1) / 2 의 회선이 필요

장점

- 안정성이 높음(한 노드가 장애가 나도 다른 노드에 영향을 미치지 않음)
- 트래픽을 분산할 수 있음

단점

- 회선이 비효율적으로 많기 때문에 구축 비용이 높음

### 토폴로지의 필요성

토폴로지를 파악함으로써 병목현상을 해결하는 척도가 됨

어떻게 토폴로지를 구성하느냐에 따라 병목현상을 해결할 수 있음

### 병목현상(bottleneck)

트래픽에 의해 데이터 흐름이 제한되는 상황(핫스팟이라고도 함)

해결 사례

구축된 시스템의 토폴로지를 알고 있다면 어떠한 부분에 어떠한 회선 또는 어떠한 서버의 용량을 증가시켜야 하는지 알 수 있음

<br>

## 네트워크 메시지 전송 방식

### 유니캐스트

1 : 1 통신, 가장 일반적인 네트워크 전송 형태

한 개의 목적지 MAC 주소를 사용하며 CPU 성능에는 문제를 주지 않음

대표적으로 HTTP 통신(네이버 주소창에 요청)

### 브로드캐스트

1 : N 통신, 그룹이 아닌 연결되어 있는 모든 노드에게 데이터 전달(채팅창)

네트워크에 있는 모든 목적지에 패킷이 전송되므로 트래픽 증가

수신 받는 목적지는 브로드캐스팅용 주소가 오면 패킷을 자신의 CPU로 처리하기 때문에 CPU 성능 저하 가능성

예시로는 ARP가 있음

### 멀티캐스트

1 : N 통신, 연결된 모든 노드들에게 데이터를 전달하는 것이 아니라 특정 그룹에게만 전달

유니캐스트와 브로드캐스트를 합친 개념

<br>

## 네트워크의 분류

### LAN(Local Area Network, 근거리 통신망)

MAN, WAN보다 높은 안정성과 속도

소규모 네트워크(집, 사무실) - 보통 허브나 스위치로 연결된 네트워크

하나의 논리적 주소인 IP(변함)를 기반으로 여러 개의 물리적 주소인 MAC(변하지 않음)으로 구별하는 네트워크

→ 하나의 IP를 NAT 기술로 여러 가상 IP들(내부적으로는 MAC 주소 기반으로 구분)로 할당

### MAN(Metropolitan Area Network, 대도시 통신망)

도시와 도시의 통신망을 뜻하며 2개 이상의 LAN이 Bridge로 연결되어 구성

라우터, 브리지 등으로 연결되는 것이 특징

### WANN(Wide Area Network, 광역 통신망)

국가와 국가와의 통신망을 뜻하며 인터넷이라고도 함

수많은 라우터를 거쳐 다른 국가와도 연결되는 범위

<br>

## TCP/IP 4계층

장치들이 인터넷 상에서 데이터를 주고받을 때 쓰는 독립적인 프로토콜의 집합

인터넷을 통해 데이터를 보낼 때 주로 TCP와 IP를 이용

- TCP(Transmission Control Protocol)
- IP(Internet Protocol)

<br>

## 응용 계층(Application)

웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층

HTTP, SMTP, SSH, FTP가 대표적

### HTTP(Hypertext Transfer Protocol)

처음에는 서버와 브라우저간에 데이터를 주고 받기 위해 설계된 프로토콜

지금은 브라우저 뿐만 아니라 서버와 서버간의 통신할 때도 많이 이용

- 헤더를 통한 확장이 쉬움, 예를 들어 헤더 값에 어떠한 값을 넣어서 HTTP 요청을 할 때 쉽게 다른 값을 추가할 수 있음

- stateless, 동일한 연결에서 연속적으로 수행되는 두 요청 사이에 연속적인 상태(state)값 없음(상태를 저장하지 않음)

### SSH(Secure SHhell Protocol)

보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜

### FTP(File Transfer Protocol)

노드와 노드간의 파일을 전송하는데 사용되는 프로토콜

지금은 파일을 암호화해서 전송하는 FTPS 또는 SFTP로 대체되고 있음

### SMTP(Simple Mail Transfer Protocol)

인터넷을 통해 메일을 보낼 때 사용되는 프로토콜

<br>

## 전송 계층(Transport)

응용 계층에서 받은 메시지를 기반으로 세그먼트 또는 데이터그램으로 데이터를 쪼개고 데이터가 오류 없이 순서대로 전달되도록 도움을 주는 층

TCP, UDP가 대표적

### TCP

가상회선 패킷 교환 방식(순서대로)

**오류 검사 메커니즘**

1. 재전송: 시간 초과 기간이 지나면 서버는 전달되지 않은 데이터에 대해 재전송을 시도
2. 체크섬: 체크섬을 통해 무결성을 평가, 송신된 데이터의 체크섬과 수신된 데이터의 체크섬 값을 비교해서 올바르게 왔는지를 확인

TCP 헤더는 20~60바이트로 가변적임

### UDP

데이터그램 패킷 교환 방식(순서 보장 안됨)

오류 검사는 단순한 체크섬만 지원

UDP 헤더는 8바이트로 고정 길이

<br>

## 인터넷 계층(Network)

한 노드에서 다른 노드로 전송 계층에서 받은 세그먼트 또는 데이터그램을 패킷화하여 목적지로 전송하는 역할

IP, ICMP, ARP가 대표적

### ICMP(Internet Control Message Protocol)

노드와 노드 사이에서 통신이 잘 되는지 확인할 때(테스팅) 쓰는 프로토콜(데이터 교환하는데는 사용되지 않음)

IP와 달리 전송 계층 프로토콜(TCP/UDP)과 연관되지 않는 독립적인 비연결형 프로토콜

<br>

## 링크 계층(Link)

데이터가 네트워크를 통해 물리적으로 전송되는 방식을 정의

데이터 링크 계층과 물리 계층을 합친 계층

전선, 광섬유, 무선 등

<br>

## 캡슐화(Encapsulation)와 비캡슐화(Decapsulation)

캡슐화는 송신자가 수신자에게 데이터를 보낼 때 데이터가 각 계층을 지나며 각 계층의 특징이 담긴 헤더들이 붙여지는 과정

ex) 전송계층은 TCP 헤더, 네트워크 계층은 IP 주소 헤더를 추가

비캡슐화는 이 과정의 역과정이며 수신자측에서 캡슐화된 데이터를 역순으로 제거하면서 응용 계층까지 도달하는 것

<br>

## PDU(Protocol Data Unit)

TCP/IP 4계층을 기반으로 설명했을 때 각 계층의 데이터 단위

- 응용 계층: 메시지
- 전송 계층: 세그먼트(TCP), 데이터그램(UDP)
- 인터넷 계층: 패킷(IP 헤더를 붙이면서 패킷화함)
- 링크 계층: 프레임(데이터 링크 계층), 비트(물리 계층)
  
<br>

- 세그먼트: 적절한 크기로 쪼갠 조각(데이터그램도 같은 의미)
- 패킷: 세그먼트에 SP(Source IP Address, 송신자의 32비트 IP 주소)와 DP(Destination IP Address, 수신자의 32비트 IP 주소)가 포함된 IP 헤더가 붙은 형태의 조각
- 프레임: MAC 주소 헤더와 CRC/체크섬 트레일러가 붙은 조각

<br>

## CRC/체크섬 트레일러

데이터의 오류 감지를 위한 수학적 함수가 적용된 값들이 있는 필드

링크의 오류(과도한 트래픽 등)로 인해 데이터 손상을 감지하는 역할

이 과정에서 CRC와 체크섬 두 가지의 과정을 기반으로 데이터 전송 오류 및 데이터 무결성 방지

- CRC: CRC-1, CRC-16 등의 알고리즘으로 나온 값을 통해 데이터 전송 오류 감지를 수행
- 체크섬: MD5, SHA-256 등의 알고리즘으로 나온 값을 통해 데이터 무결성을 방지

<br>

## OSI 7계층

TCP/IP 4계층을 OSI 7계층 모델로 설명하기도 함

응용 계층을 세 개로 쪼개고 링크 계층을 데이터 링크 계층, 물리 계층으로 나눠서 표현

인터넷 계층을 네트워크 계층으로 부름

<br>

## MTU(Maximum Transmission Unit)

네트워크에 연결된 장치가 받아들일 수 있는 최대 데이터 패킷의 크기

이 크기를 기준으로 데이터가 쪼개져서 패킷화됨

네트워크 경로 상에 있는 아무 장치나 MTU보다 패킷이 크면 그 패킷은 분할될 수도 있음

**패킷이 분할되지 않는 경우**

패킷을 분할할 수 없어 네트워크 경로 상에 있는 어떠한 라우터나 장치의 MTU를 초과할 때 분할해서 전달하는 것이 아니라 아예 전달하지 않을 수도 있음

- IPv6는 분할을 허용하지 않음
- IPv4 헤더에는 flags라는 필드가 있는데 여기서 bit가 1이되면 "Don't Fragment" 플래그가 활성화된다라는 의미이고 분할 불가능

### MTU와 MSS

MTU는 IP 헤더와 TCP 헤더의 크기까지 합치지만 MSS(Maximum Segment Size)는 데이터의 크기(Payload의 크기)만을 가리킴

일반적으로 MTU는 1500바이트이며 MSS는 1460바이트

→ 네트워크를 통해 데이터를 보낼 때 MTU가 1500이라도 데이터는 보통 1460바이트 이하의 크기로 보내야 전달이 됨(TCP를 쓰지 않으면 달라질 수도 있음)

### PMTUD(Path MTU Discovery)

수신자와 송신자의 경로 상에서 장치가 패킷을 누락한 경우 테스트 패킷의 크기를 낮추면서 MTU에 맞게끔 반복해서 보내는 과정

<br>

## 3-Way 핸드셰이크

TCP의 연결 성립은 다음과 같이 3개의 과정을 거침

1. SYN 단계: 클라이언트는 서버에 클라이언트의 ISN을 담아 SYN을 보낸다
2. SYN + ACK 단계: 서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며 승인 번호로 클라이언트의 ISN + 1을 보낸다
3. ACK 단계: 클라이언트는 서버의 ISN + 1한 값인 승인 번호를 담아 ACK를 서버에 보낸다

- SYN: Synchronization, 연결 요청 플래그
- ACK: Acknowledgement, 응답 플래그
- ISN: TCP 기반 데이터 통신에서 각각의 새 연결에 할당된 고유한 32비트 시퀀스 번호

TCP 연결을 하면서 클라이언트는 Closed, Syn-sent, Established 상태가 됨

서버는 Closed, Listen(클라이언트의 연락을 기다리는 상태, 이를 기반으로 서버 메서드의 이름 결정), Syn_received, Established 상태가 됨

이러한 서버와 클라이언트 간의 연결 설정 과정이 있기 때문에 TCP는 신뢰성이 있고 이러한 과정이 없는 UDP는 신뢰성이 없음

<br>

## 4-Way 핸드셰이크

TCP의 연결 해제는 다음과 같이 4개의 과정을 거침

1. 먼저 클라이언트가 연결을 닫으려고 할 때 FIN으로 설정된 세그먼트를 보내고 FIN_WAIT_1 상태로 들어가 서버의 응답 기다림
2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보내고 CLOSE_WAIT 상태에 들어가며 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태에 들어감
3. 서버는 LAST_ACK 상태가 되며 일정 시간 이후에 클라이언트에 FIN이라는 세그먼트를 보냄
4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 되며 이후 클라이언트는 어느 정도의 시간(TIME_WAIT으로 설정된 시간)을 대기한 후 연결이 닫힘

### TIME_WAIT

지연 패킷 등이 발생했을 때 데이터 무결성을 해결하기 위해 패킷을 기다리는 시간

2 * MSL(Maximum Segment Lifetime, 최대 패킷 수명)동안 기다림